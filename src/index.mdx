import OvermindLogo from './components/OvermindLogo';
import { Head, Notes, Code as MdxCode, updaters } from 'mdx-deck';
import Quote from './components/Quote';
import Appear from './components/Appear';
import Steps from './components/Steps';
import Soon from './components/Soon';
import Pipe from './components/Pipe';
import Pipes from './components/Pipes';
import Image from './components/Image';
import GoTo from './components/GoTo';
import CodeSurfer from './components/CodeSurfer';
import { Text, Title, SubTitle, Code, Link, Button } from './components/Typo';
import Arrow from './components/Arrow';
import PrezLink, { HttpsPart } from './components/PrezLink';
import { TIME_MODE } from './utils/TimeModeCtx';
// import { CodeSurfer } from "mdx-deck-code-surfer";
// import SyntaxHighlighter from 'react-syntax-highlighter';
import imgDevtool1 from './images/devtool-01.png';
import imgDevtool2 from './images/devtool-02.png';
import imgDevtool3 from './images/devtool-03.png';
import imgVersions from './images/versions.png';

<Head>
  <title>Overmind - TypeScript Paris - Etienne Dldc</title>
  <meta name="og:image" content="https://overmind-talk.etienne.tech/card.png" />
</Head>

<Title>Hi 👋</Title>

<PrezLink href="https://overmind-talk.etienne.tech">
  <HttpsPart>https://</HttpsPart>overmind-talk.etienne.tech
</PrezLink>

---

<OvermindLogo size="50vh" />

---

<Title>Overmind</Title>

<Appear>
  <Text>State Management library 👷‍</Text>
  <Text>Manage everything but the view 🧠</Text>
  <Text>Supports React, Vue & Angular ✨</Text>
  <Text>
    By the team behind <Link href="https://cerebraljs.com/">CerebralJS</Link> 🚀{' '}
  </Text>
  <Text>Made with TS, for TS 🚀</Text>
</Appear>

<Notes>Overmind is state management library, but in manage more than just the state.</Notes>

---

<Title>✋ I'm Etienne</Title>

<Appear>
  <Text>👨‍🎓 Master degree at Gobelins</Text>
  <Text>
    ⚛ React trainer & dev & consultant <Link href="https://twitter.com/LeReacteurIO">@LeReacteurIO</Link>
  </Text>
  <Text>🖥 Freelance</Text>
</Appear>

---

<Title>Mental model</Title>

<Appear>
  <Quote author="Wikipedia">
    " A mental model is a representation of the surrounding world, the relationships between its various parts and a
    person's intuitive perception about his or her own acts and their consequences. "
  </Quote>
</Appear>

---

<Title>In Programming</Title>

<Appear>
  <Text>
    In programming, mental model is about understanding what your program does and how you have to change it to acheive
    what you want.
  </Text>
</Appear>

---

<Title>
  Libraries help us shape <br /> the mental model of our apps
</Title>

<Appear>
  <Text>
    React <Arrow /> Components
  </Text>
  <Text>
    Redux <Arrow /> Action, Reducer
  </Text>
</Appear>

---

<Title>Naming is important</Title>

<Appear>
  <Text>
    Presentational <Arrow double={true} /> Container Components
  </Text>
  <Text>
    <code>render</code> <Arrow double={true} /> <code>handleInputChange</code>
  </Text>
</Appear>

---

<Title>Overmind Mental model</Title>

<Appear>
  <Text>State</Text>
  <Text>Derive</Text>
  <Text>Effects</Text>
  <Text>Action</Text>
</Appear>

---

<Title>State</Title>

<Appear>
  <Text>One unique state tree (like Redux)</Text>
  <Text>Define what your app look like</Text>
  <Text>When you update the state, the view get updated too</Text>
</Appear>

---

<Title>Derive</Title>

<Appear>
  <Code>(state: State) => DerivedValue</Code>
  <Text>When you update the state, drived get updated too</Text>
  <Text>In the view, derived are used like state</Text>
  <Text>In fact derived are in the state</Text>
</Appear>

---

<Title>Effects</Title>

<Appear>
  <Text>Anything related to side effects</Text>
  <Text>Like fetching data, writting local storage, generating a new id</Text>
  <Text>Overmind does nothing with them...</Text>
  <Text>...except tracking, so they appear in the devtool</Text>
</Appear>

---

<Title>Action</Title>

<Appear>
  <Text>Do stuff</Text>
  <Text>Like changing the state and using effects</Text>
  <Code>{`async (ctx: Context) => any`}</Code>
</Appear>

---

<Title>Context</Title>

<Appear>
  <Code>...Effects</Code>
  <Code>state</Code>
  <Code>value</Code>
  <Code>myAction(value)</Code>
</Appear>

---

<Title>Mutation</Title>

<Appear>
  <Text>Just mutate the state</Text>
  <Code>state.isLoading = true</Code>
  <Text>Uses Proxy under the hood to track changes</Text>
  <Text>Can't mutate outside of an action</Text>
</Appear>

---

<CodeSurfer
  neverFast={true}
  title={() => <Title>Action</Title>}
  code={require('!raw-loader!./code-samples/simple-action.ts')}
  lang="typescript"
  showNumbers={false}
  dark={true}
  steps={[{}, { range: [1, 5] }, { range: [6, 9] }, { lines: [12, 13] }, {}]}
/>

---

<Title>Pipe Action</Title>

<Steps>
  <Pipe step={0} />
  <Pipe step={1} />
  <Pipe step={2} />
  <Pipe step={3} />
</Steps>

---

<Title>Pipe Action</Title>

<SubTitle>Operations</SubTitle>

<Steps>
  <Pipes pipeIndex={0} />
  <Pipes pipeIndex={1} />
  <Pipes pipeIndex={2} />
  <Pipes pipeIndex={3} />
</Steps>

---

<Title>Pipe Action</Title>

<SubTitle>
  <Link href="https://github.com/christianalfoni/op-op-spec/blob/master/README.md">op-op-spec</Link>
</SubTitle>

<Steps>
  <div>
    <MdxCode className="language-typescript">{`function operator (err, value, next, final = next) {}`}</MdxCode>
  </div>
  <div>
    <MdxCode className="language-typescript">{`type Operator<Input, Output = Input> = (
  err: Error,
  value: Input,
  next: (err: Error, value: Output) => void,
  final: (err: Error, value: Output) => void
) => void`}</MdxCode>
  </div>
</Steps>

---

<Title>Pipe Action</Title>

<SubTitle>Operators</SubTitle>

<Appear>
  <Text>Mutate</Text>
  <Text>Run</Text>
  <Text>Map</Text>
  <Text>Filter</Text>
  <Text>When</Text>
  <Text>Debounce</Text>
  <Text>...</Text>
</Appear>

---

<Title>Pipe Action</Title>

<SubTitle>Operators</SubTitle>

<MdxCode className="language-typescript">{`const mutate = (
  doMutation: (context: Context) => void
): Operator => {
  // ...
}`}</MdxCode>

---

<Title>Pipe Action</Title>

<SubTitle>Operators</SubTitle>

<MdxCode className="language-typescript">{`const setIsLoading = mutate(({ state, value }) => {
  state.isLoading = value
})`}</MdxCode>

---

<CodeSurfer
  neverFast={true}
  title={() => <Title>Pipe Operator</Title>}
  code={require('!raw-loader!./code-samples/pipe-operator.ts')}
  lang="typescript"
  showNumbers={false}
  dark={true}
  steps={[{}, { lines: [1, 11] }, { lines: [2, 10] }, { range: [5, 8] }, {}]}
/>

---

<CodeSurfer
  neverFast={true}
  title={() => <Title>Pipe Operator</Title>}
  code={require('!raw-loader!./code-samples/pipe.ts')}
  lang="javascript"
  showNumbers={false}
  dark={true}
  steps={[{}, { lines: [1, 6] }, { range: [2, 5] }, {}]}
/>

---

<Title>Devtools 🚀</Title>

<Steps>
  <Image height="70vh" src={imgDevtool1} />
  <Image height="70vh" src={imgDevtool2} />
  <Image height="70vh" src={imgDevtool3} />
</Steps>

---

<Title>Running the Devtools</Title>

<Steps>
  <Code>npx overmind-devtools</Code>
</Steps>

---

<Title>Move fast, break things 🏎</Title>

<Appear>
  <SubTitle> ☝️ but not semver</SubTitle>
  <Image height="50vh" src={imgVersions} />
</Appear>

---

<Title>Do we have time for more API ?</Title>

<GoTo>
  {({ update, setTimeMode }) => (
    <Button
      onClick={() => {
        setTimeMode(TIME_MODE.normal);
        update(updaters.next);
        if (document.activeElement) {
          document.activeElement.blur();
        }
      }}
    >
      Yep
    </Button>
  )}
</GoTo>

<GoTo>
  {({ update, setTimeMode }) => (
    <Button
      warning
      onClick={() => {
        setTimeMode(TIME_MODE.fast);
        update(updaters.next);
        if (document.activeElement) {
          document.activeElement.blur();
        }
      }}
    >
      Not really
    </Button>
  )}
</GoTo>

<GoTo>
  {({ update, setTimeMode }) => (
    <Button
      danger
      onClick={() => {
        setTimeMode(TIME_MODE.fast);
        update({ index: 34 });
        if (document.activeElement) {
          document.activeElement.blur();
        }
      }}
    >
      Hell No !
    </Button>
  )}
</GoTo>

---

<CodeSurfer
  title={() => <Title>State</Title>}
  code={require('!raw-loader!./code-samples/state.ts')}
  lang="typescript"
  showNumbers={false}
  dark={true}
  steps={[
    {},
    { range: [1, 5], notes: 'Some types' },
    { range: [7, 9], notes: 'State types' },
    { range: [11, 19], notes: 'Initial state' },
  ]}
/>

---

<CodeSurfer
  title={() => <Title>Derive</Title>}
  code={require('!raw-loader!./code-samples/derive.ts')}
  lang="typescript"
  showNumbers={false}
  dark={true}
  steps={[
    {},
    { lines: [1], notes: 'Import the Derive type' },
    { lines: [3, 4], notes: 'Derive is a function...' },
    { lines: [3, 4], notes: '...receiving the state...' },
    { lines: [4], notes: '...and returning a value' },
    { lines: [13], notes: 'Then you just add it to the state' },
    {},
  ]}
/>

---

<CodeSurfer
  title={() => <Title>Effects</Title>}
  code={require('!raw-loader!./code-samples/effects.ts')}
  lang="typescript"
  showNumbers={false}
  dark={true}
  steps={[
    {},
    { range: [1, 5], notes: 'Just define a function or anything' },
    { range: [7, 9], notes: "Typescript will infer it's type" },
  ]}
/>

---

<CodeSurfer
  title={() => <Title>Actions</Title>}
  code={require('!raw-loader!./code-samples/actions.ts')}
  lang="typescript"
  showNumbers={false}
  dark={true}
  steps={[
    {},
    { lines: [1], notes: 'Import stuff from overmind' },
    { range: [2, 8], notes: 'Action receive the context' },
    { lines: [9], notes: 'Asynchronous call' },
    { lines: [11], notes: 'using effect' },
    { lines: [16], notes: 'Mutation' },
    { range: [19, 21], notes: 'The we just put it in an object' },
    {},
  ]}
/>

---

<CodeSurfer
  title={() => <Title>Pipe Actions</Title>}
  code={require('!raw-loader!./code-samples/pipe-actions.ts')}
  lang="typescript"
  showNumbers={false}
  dark={true}
  steps={[
    {},
    { lines: [1], notes: 'Import stuff from overmind' },
    { range: [2, 8], notes: 'Import operations from a separate files' },
    { lines: [10, 11, 12, 19], notes: 'We use the pipe() function' },
    { lines: [13] },
    { lines: [14] },
    { lines: [15] },
    { lines: [16] },
    { lines: [17] },
    { lines: [18] },
    { range: [21, 23], notes: 'Then we just put it in an object' },
  ]}
/>

---

<CodeSurfer
  title={() => <Title>Operations</Title>}
  code={require('!raw-loader!./code-samples/operations.ts')}
  lang="typescript"
  showNumbers={false}
  dark={true}
  steps={[
    {},
    { lines: [2], notes: 'Imports' },
    { range: [4, 6] },
    { lines: [5], notes: 'we receive the context' },
    { lines: [5], notes: 'with the value in it' },
    { range: [8, 11] },
    { lines: [9], notes: 'The context also have effects' },
    { range: [13, 17], notes: 'Mutation' },
    { lines: [14], notes: 'The context has state' },
    { lines: [15], notes: 'We just mutate the state' },
    { lines: [15], notes: 'Under the hood it uses Proxy' },
    { lines: [15], notes: "You can't mutate outside of `mutate` operation" },
    {},
  ]}
/>

---

<CodeSurfer
  neverFast={true}
  title={() => <Title>App</Title>}
  code={require('!raw-loader!./code-samples/app.ts')}
  lang="typescript"
  showNumbers={false}
  dark={true}
  steps={[
    {},
    { lines: [1], notes: 'We import Overmind' },
    { range: [3, 7], notes: 'Declaring a config object' },
    { lines: [13], notes: 'Then instantiate the app' },
    { lines: [1, 9, 10, 11], notes: 'Hacky things to get awesome typing !' },
    { lines: [1, 9, 10, 11], notes: 'Just copy paste it once then forget it' },
    {},
  ]}
/>

---

<CodeSurfer
  neverFast={true}
  title={() => <Title>Connecting a view</Title>}
  code={require('!raw-loader!./code-samples/connect.ts')}
  lang="typescript"
  showNumbers={false}
  dark={true}
  steps={[
    {},
    { lines: [3], notes: 'Import createConnect function' },
    { lines: [4], notes: 'From a separate package' },
    { lines: [10], notes: 'Create the connect' },
    { lines: [8], notes: 'Type of app prop (see next slide)' },
    {},
  ]}
/>

---

<CodeSurfer
  neverFast={true}
  title={() => <Title>Using connect</Title>}
  code={require('!raw-loader!./code-samples/view.tsx')}
  lang="typescript"
  showNumbers={false}
  dark={true}
  steps={[
    {},
    { lines: [2], notes: 'import from app' },
    { lines: [24], notes: 'connect is a HOC' },
    { lines: [4], notes: 'Connect type contains app' },
    { lines: [14], notes: 'Use app.state to access the state' },
    { lines: [14], notes: 'Overmind knows this component uses app.state.newTodoTitle' },
    { lines: [14], notes: 'and will automatically update if this state change' },
    { lines: [14], notes: 'This works because ✨ Proxy ✨' },
    { lines: [15], notes: 'Actions are on app.actions' },
    { lines: [15], notes: 'The value passed to the action will be passed as context.value' },
    {},
  ]}
/>

---

<div style={{ position: 'relative' }}>
  <Title>That's it, thanks</Title>
  <Appear>
    <SubTitle>
      <Link href="https://next.overmindjs.org/">next.overmindjs.org</Link>
    </SubTitle>
    <SubTitle>Questions ?</SubTitle>
    <div style={{ position: 'absolute', width: '80vw', transform: 'translate(-50%, 10vh) scale(0.8)', left: '50%' }}>
      <Text>
        PS: I'm on 🐦 <Link href="https://twitter.com/Etienne_dot_js">@Etienne_dot_js</Link>
      </Text>
    </div>
  </Appear>
</div>
